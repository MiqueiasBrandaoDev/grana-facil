# ü§ñ GRANA IA - Documenta√ß√£o Completa

## üöÄ Vis√£o Geral

A **Grana IA** √© um agente de intelig√™ncia artificial super avan√ßado, powered by **GPT-4o**, que revoluciona o controle financeiro pessoal. O sistema processa linguagem natural em portugu√™s brasileiro e executa a√ß√µes financeiras automaticamente.

## ‚ú® Recursos Principais

### üß† **Intelig√™ncia Artificial Avan√ßada**
- **GPT-4o** com prompts otimizados para contexto brasileiro
- Processamento de linguagem natural em portugu√™s
- An√°lise contextual baseada no hist√≥rico do usu√°rio
- Confian√ßa e reasoning detalhados para cada a√ß√£o

### üí∞ **Gest√£o Financeira Autom√°tica**
- **Transa√ß√µes inteligentes**: Cria√ß√£o autom√°tica com categoriza√ß√£o
- **Categorias din√¢micas**: Cria√ß√£o autom√°tica baseada em padr√µes
- **Metas personalizadas**: Sugest√µes baseadas no perfil financeiro
- **Conselhos inteligentes**: An√°lise de padr√µes e sugest√µes

### üì± **Integra√ß√£o WhatsApp Completa**
- Interface de chat moderna no webapp
- Webhook para WhatsApp Business API real
- Processamento em tempo real de mensagens
- Suporte a m√∫ltiplos usu√°rios simult√¢neos

## üèóÔ∏è Arquitetura do Sistema

### **Core Components**

#### `AIFinancialAgent` (`src/lib/ai-agent.ts`)
```typescript
// Agente principal da IA
class AIFinancialAgent {
  async processCommand(message: string): Promise<AIAgentResponse>
  private analyzeIntent(message: string): Promise<any>
  private executeActions(analysis: any): Promise<AIAgentResponse>
}
```

**Capacidades:**
- ‚úÖ Processar transa√ß√µes em linguagem natural
- ‚úÖ Criar categorias automaticamente
- ‚úÖ Sugerir e criar metas financeiras
- ‚úÖ Analisar padr√µes de gastos
- ‚úÖ Dar conselhos financeiros personalizados
- ‚úÖ Gerenciar contas a pagar/receber

#### `useAIAgent` (`src/hooks/useAIAgent.ts`)
```typescript
// Hook React para integra√ß√£o com a IA
const {
  processCommand,
  processChatMessage,
  analyzeFinancialPatterns,
  suggestSmartGoals,
  organizeCategories,
  getFinancialInsights
} = useAIAgent();
```

#### `WhatsAppWebhookService` (`src/lib/whatsapp-webhook.ts`)
```typescript
// Servi√ßo completo de webhook WhatsApp
class WhatsAppWebhookService {
  verifyWebhook(mode, token, challenge): string | null
  processWebhook(payload): Promise<void>
  sendMessage(to, phoneNumberId, text): Promise<boolean>
}
```

## üí¨ Exemplos de Comandos

### **Transa√ß√µes**
```
Usu√°rio: "Gastei 50 reais no P√£o de A√ß√∫car comprando comida"
Grana IA: "üí∏ Transa√ß√£o criada: Compras no P√£o de A√ß√∫car - R$ 50,00
üìÇ Categoria: Alimenta√ß√£o (95% confian√ßa)
ü§ñ An√°lise: P√£o de A√ß√∫car √© uma rede de supermercados brasileira"

Usu√°rio: "Recebi meu sal√°rio de 3000 reais"
Grana IA: "üí∞ Receita adicionada: Sal√°rio - R$ 3.000,00
üìÇ Categoria: Sal√°rio (98% confian√ßa)
üí° Sugest√£o: Considere criar uma meta de economia mensal"
```

### **Metas Financeiras**
```
Usu√°rio: "Quero economizar 10000 reais em 12 meses para uma viagem"
Grana IA: "üéØ Meta criada: Viagem - R$ 10.000,00
üìÖ Prazo: 12 meses (R$ 833,33/m√™s)
üí° An√°lise: Com sua renda atual, √© uma meta realiz√°vel
üöÄ Dica: Configure uma transfer√™ncia autom√°tica mensal"
```

### **Categorias Autom√°ticas**
```
Usu√°rio: "Crie uma categoria para gastos com meus pets"
Grana IA: "üè∑Ô∏è Categoria criada: Pets üêï
üí∞ Or√ßamento sugerido: R$ 200,00/m√™s
üìä Baseado em: Padr√µes de gastos similares
‚ú® Status: Ativa e pronta para uso"
```

### **An√°lises e Conselhos**
```
Usu√°rio: "Como est√£o meus gastos este m√™s?"
Grana IA: "üìä An√°lise Financeira de Novembro:

üí∞ Receitas: R$ 3.000,00
üí∏ Despesas: R$ 2.100,00
üíµ Economia: R$ 900,00 (30%)

üèÜ Top Categorias:
‚Ä¢ Alimenta√ß√£o: R$ 800,00 (38%)
‚Ä¢ Transporte: R$ 500,00 (24%)
‚Ä¢ Lazer: R$ 300,00 (14%)

üí° Insights:
‚úÖ Voc√™ est√° economizando bem!
‚ö†Ô∏è Gastos com alimenta√ß√£o acima do ideal
üéØ Sugest√£o: Considere meal prep para reduzir custos"
```

## üõ†Ô∏è Implementa√ß√£o T√©cnica

### **1. Configura√ß√£o Inicial**

#### Vari√°veis de Ambiente
```env
# OpenAI
VITE_OPENAI_API_KEY=sk-your-openai-key

# Supabase
VITE_SUPABASE_URL=your-supabase-url
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key

# WhatsApp (opcional)
VITE_WHATSAPP_ACCESS_TOKEN=your-meta-business-token
VITE_WHATSAPP_PHONE_NUMBER_ID=your-phone-number-id
VITE_WHATSAPP_VERIFY_TOKEN=granaboard_webhook_verify
VITE_WHATSAPP_WEBHOOK_URL=https://your-domain.com/api/whatsapp/webhook
```

### **2. Uso da Grana IA**

#### No Frontend (React)
```typescript
import { useAIAgent } from '@/hooks/useAIAgent';

function ChatComponent() {
  const { processChatMessage, isProcessing } = useAIAgent();
  
  const handleMessage = async (message: string) => {
    const response = await processChatMessage(message);
    console.log(response.botMessage);
  };
}
```

#### Processamento Direto
```typescript
import { aiAgent } from '@/lib/ai-agent';

const response = await aiAgent.processCommand(
  "Gastei 75 reais no Carrefour comprando alimentos"
);

console.log(response.message); // Resposta da IA
console.log(response.actions); // A√ß√µes executadas
console.log(response.confidence); // N√≠vel de confian√ßa
```

### **3. Configura√ß√£o do Webhook WhatsApp**

#### Meta Developers Console
1. Acesse [developers.facebook.com](https://developers.facebook.com)
2. Crie um app "Business"
3. Adicione "WhatsApp Business API"
4. Configure:
   - **Webhook URL**: `https://seu-dominio.com/api/whatsapp/webhook`
   - **Verify Token**: `granaboard_webhook_verify`
   - **Webhook Fields**: `messages`

#### Implementa√ß√£o do Endpoint
```typescript
// Exemplo para Next.js API Route
export default async function handler(req, res) {
  const whatsappService = createWhatsAppWebhookService();
  
  if (req.method === 'GET') {
    // Verifica√ß√£o do webhook
    const result = whatsappService.verifyWebhook(
      req.query['hub.mode'],
      req.query['hub.verify_token'],
      req.query['hub.challenge']
    );
    return res.status(200).send(result);
  }
  
  if (req.method === 'POST') {
    // Processar mensagens
    await whatsappService.processWebhook(req.body);
    return res.status(200).json({ success: true });
  }
}
```

## üìä Banco de Dados

### **Tabelas Principais**
- `users`: Usu√°rios do sistema
- `transactions`: Transa√ß√µes financeiras
- `categories`: Categorias de gastos/receitas
- `goals`: Metas financeiras
- `bills`: Contas a pagar/receber
- `whatsapp_messages`: Hist√≥rico de conversas

### **Views Otimizadas**
- `transactions_with_category`: Transa√ß√µes com dados da categoria
- `monthly_summary`: Resumo mensal por usu√°rio
- `goal_progress`: Progresso das metas
- `upcoming_bills`: Contas pr√≥ximas do vencimento

### **Functions**
- `get_user_balance(user_id)`: Calcula saldo total
- `get_monthly_spending_by_category(user_id, month)`: Gastos por categoria
- `process_whatsapp_transaction(user_id, message)`: Processa transa√ß√£o via WhatsApp

## üîß Configura√ß√£o Avan√ßada

### **Personaliza√ß√£o de Prompts**
O sistema permite personaliza√ß√£o dos prompts da IA editando `buildAnalysisPrompt()` em `ai-agent.ts`:

```typescript
private buildAnalysisPrompt(message: string): string {
  return `
CONTEXTO PERSONALIZADO:
- Foco em economia familiar
- Priorizar categorias de alimenta√ß√£o e educa√ß√£o
- Sugerir metas conservadoras

MENSAGEM: "${message}"
...
  `;
}
```

### **Extens√£o de Funcionalidades**
Para adicionar novas capacidades:

1. **Novo tipo de a√ß√£o** em `AIAction`
2. **Implementar handler** em `executeAction()`
3. **Atualizar prompts** para reconhecer novos comandos

```typescript
// Exemplo: Adicionar sugest√µes de investimento
case 'investment_suggestion':
  return this.suggestInvestments(data);
```

## üöÄ Deploy e Produ√ß√£o

### **Frontend (Vercel/Netlify)**
```bash
npm run build
npm run preview  # Testar build local
# Deploy autom√°tico via Git
```

### **Backend do Webhook**
- **Vercel Functions**: Autom√°tico com Next.js
- **Netlify Functions**: Arquivo em `netlify/functions/`
- **Railway/Render**: Deploy direto do reposit√≥rio

### **Monitoramento**
- Logs de conversas no Supabase
- M√©tricas de uso da OpenAI API
- Status de webhooks do WhatsApp

## üì± Teste em Desenvolvimento

### **Chat Local**
1. Configure `VITE_OPENAI_API_KEY`
2. Execute `npm run dev`
3. Acesse `/whatsapp` no app
4. Teste comandos na interface

### **Webhook Local**
1. Instale ngrok: `npm install -g ngrok`
2. Execute seu servidor: `npm run dev`
3. Execute ngrok: `ngrok http 3000`
4. Use URL do ngrok no Meta Developers

### **Comandos de Teste**
```
‚úÖ "Gastei 45 reais no Extra comprando frutas"
‚úÖ "Recebi 2500 de freelance hoje"
‚úÖ "Quero juntar 8000 reais em 10 meses"
‚úÖ "Crie uma categoria para gastos m√©dicos"
‚úÖ "Como est√£o minhas finan√ßas?"
‚úÖ "Me d√™ conselhos para economizar"
```

## üîí Seguran√ßa

### **API Keys**
- Nunca commitar keys no reposit√≥rio
- Usar vari√°veis de ambiente
- Rotacionar tokens regularmente

### **Webhook Security**
- Verificar `verify_token` do WhatsApp
- Validar origem das requisi√ß√µes
- Rate limiting para evitar spam

### **Dados do Usu√°rio**
- RLS (Row Level Security) no Supabase
- Criptografia de dados sens√≠veis
- LGPD compliance para dados brasileiros

## üéØ Roadmap

### **Pr√≥ximas Features**
- [ ] An√°lise de documentos (extratos PDF)
- [ ] Integra√ß√£o com bancos via Open Banking
- [ ] Relat√≥rios visuais avan√ßados
- [ ] Machine Learning para previs√µes
- [ ] App mobile nativo
- [ ] Multi-idiomas (ingl√™s, espanhol)

### **Melhorias da IA**
- [ ] Fine-tuning com dados do usu√°rio
- [ ] An√°lise de sentimento financeiro
- [ ] Detec√ß√£o de fraudes
- [ ] Conselhos de investimento personalizados

---

## üÜò Suporte

### **Documenta√ß√£o**
- C√≥digo bem documentado em TypeScript
- Exemplos pr√°ticos em cada m√≥dulo
- Testes unit√°rios (TODO)

### **Community**
- Issues no GitHub
- Discord/Slack para desenvolvedores
- Wiki colaborativa

### **Contato**
- üìß Email: suporte@granaboard.com
- üí¨ WhatsApp: +55 11 99999-9999
- üåê Site: https://granaboard.com

---

**üéâ A Grana IA est√° pronta para revolucionar como voc√™ gerencia suas finan√ßas!**